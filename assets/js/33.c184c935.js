(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{392:function(a,t,e){"use strict";e.r(t);var s=e(41),r=Object(s.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"terraform-import"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#terraform-import"}},[a._v("#")]),a._v(" Terraform Import")]),a._v(" "),e("p",[a._v("Terraform can import existing infrastructure, which means you can import AWS resources created by some other method to be henceforth managed by Terraform and your IaC.")]),a._v(" "),e("p",[a._v("The "),e("code",[a._v("terraform import")]),a._v(" command modifies the state and must be executed by an AWS Account Admin.")]),a._v(" "),e("ol",[e("li",[a._v("(Developer) Write a resource block and push the code changes:")])]),a._v(" "),e("div",{staticClass:"language-hcl extra-class"},[e("pre",{pre:!0,attrs:{class:"language-hcl"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Example")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("resource "),e("span",{pre:!0,attrs:{class:"token type variable"}},[a._v('"aws_cloudwatch_log_group"')])]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"example"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[a._v("name")]),a._v("              "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/aws/lambda/'),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token type variable"}},[a._v("lambda_function_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")])]),a._v('"')]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[a._v("retention_in_days")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("14")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[a._v("(Admin) Login to the AWS account with the "),e("code",[a._v("aws-adfs")]),a._v(" utility; select Admin role.")]),a._v(" "),e("li",[a._v("(Admin) "),e("code",[a._v("terraform import")]),a._v(" doesn't work with a dynamic provider config (known limitation).\n"),e("ul",[e("li",[a._v("Temporarily/locally hard-code the region in the provider block:")])]),a._v(" "),e("div",{staticClass:"language-hcl extra-class"},[e("pre",{pre:!0,attrs:{class:"language-hcl"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# DOES NOT WORK with import command:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("provider"),e("span",{pre:!0,attrs:{class:"token type variable"}},[a._v(' "aws" ')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[a._v("region")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" var.region\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# WORKS with import command:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("provider"),e("span",{pre:!0,attrs:{class:"token type variable"}},[a._v(' "aws" ')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[a._v("region")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"us-east-2"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),a._v(" "),e("li",[a._v("(Admin) Locally, in the "),e("code",[a._v("iac/{env}")]),a._v(" directory where the state file is, run:\n"),e("ol",[e("li",[e("code",[a._v("terraform init")])]),a._v(" "),e("li",[e("code",[a._v("terraform import <resource address in your IaC> <existing id in AWS>")])])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Example")]),a._v("\nterraform "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("import")]),a._v(" module.build_lambda.aws_cloudwatch_log_group.example /aws/lambda/example-fxn\n")])])])]),a._v(" "),e("li",[a._v("(Developer) Build/deploy.\n"),e("ul",[e("li",[a._v("Now that the existing resource is recorded in your state, "),e("code",[a._v("terraform apply")]),a._v(" shouldn't yield a "),e("code",[a._v("ResourceAlreadyExistsException")]),a._v(".")])])]),a._v(" "),e("li",[a._v("(Admin) Discard the change to hard-code the provider region.")])]),a._v(" "),e("details",{staticClass:"custom-block details"},[e("summary",[a._v("Example Use Case: Expire Lambda Logs")]),a._v(" "),e("h3",{attrs:{id:"scenario"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#scenario"}},[a._v("#")]),a._v(" Scenario")]),a._v(" "),e("p",[a._v("AWS Lambda functions automatically store log output in Amazon CloudWatch Logs by creating a CloudWatch Logs group for your Lambda function, named "),e("code",[a._v("/aws/lambda/{lambda-function-name}")]),a._v(".")]),a._v(" "),e("p",[a._v("Optionally, you could explicitly manage the CloudWatch Log group for a Lambda in your IaC.")]),a._v(" "),e("div",{staticClass:"language-hcl extra-class"},[e("pre",{pre:!0,attrs:{class:"language-hcl"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("resource "),e("span",{pre:!0,attrs:{class:"token type variable"}},[a._v('"aws_lambda_function"')])]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"datahub_lambda"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[a._v("function_name")]),a._v("    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" var.lambda_function_name\n    ...\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# optional ")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("resource "),e("span",{pre:!0,attrs:{class:"token type variable"}},[a._v('"aws_cloudwatch_log_group"')])]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"example"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[a._v("name")]),a._v("              "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/aws/lambda/'),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token type variable"}},[a._v("lambda_function_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")])]),a._v('"')]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[a._v("retention_in_days")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("14")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),e("p",[a._v("Managing the Log Group in your IaC could be beneficial in order to set a log retention (logs that never expire accumulate and become difficult to search).")]),a._v(" "),e("h3",{attrs:{id:"problem"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#problem"}},[a._v("#")]),a._v(" Problem")]),a._v(" "),e("p",[a._v("The log group you create via Terraform for your Lambda function must be named "),e("code",[a._v("/aws/lambda/{lambda-function-name}")]),a._v(".")]),a._v(" "),e("p",[a._v("If the Lambda function is already live and has already created its CloudWatch Log Group with this name, when you add the Log Group resource to your IaC,  "),e("code",[a._v("terraform apply")]),a._v(" will fail:")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("Error: Creating CloudWatch Log Group failed: \nResourceAlreadyExistsException: The specified log group already exists.\n")])])]),e("h3",{attrs:{id:"solution"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#solution"}},[a._v("#")]),a._v(" Solution")]),a._v(" "),e("p",[a._v("Import the existing Log Group to attach it to your IaC. This records the existing resource in your Terraform state file so it can be henceforth managed by Terraform.")])])])}),[],!1,null,null,null);t.default=r.exports}}]);