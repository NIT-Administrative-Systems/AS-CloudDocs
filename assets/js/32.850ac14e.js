(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{393:function(t,a,s){"use strict";s.r(a);var e=s(41),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"application-load-balancers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#application-load-balancers"}},[t._v("#")]),t._v(" Application Load Balancers")]),t._v(" "),s("p",[t._v("Application Load Balancers (ALBs) are Amazon's latest load balancer offering. They are a significant upgrade over the classic Elastic Load Balancers (ELBs) -- one running ALB can inspect an HTTP request's "),s("code",[t._v("Host")]),t._v(" header and route to the correct application, eliminating the need for several always-on load balancers.")]),t._v(" "),s("p",[t._v("If your application requires a load balancer, an ALB should be the first choice. There may be some advanced cases where a Network Load Balancer (NLB) is appropriate instead.")]),t._v(" "),s("p",[t._v("The EACD-CloudOps group provisions an ALB intended to be shared by several microservice or API applications in each AWS account. The information needed to use this shared ALB is available through your shared account resource IaC module.")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("Customer-Facing Applications")]),t._v(" "),s("p",[t._v("The shared account ALB is "),s("strong",[t._v("not")]),t._v(" intended for use by customer-facing web applications.")]),t._v(" "),s("p",[t._v("Only one app may create a listener for port 443. Using non-standard ports for APIs is a good trade-off of cost:convenience, since most of our services are going to be proxied through the API gateway provider anyway.")]),t._v(" "),s("p",[t._v("You can provision your own ALB directly with terraform, or by using our "),s("RouterLink",{attrs:{to:"/iac/available-modules.html"}},[t._v("ALB terraform module")]),t._v(".")],1)]),t._v(" "),s("h2",{attrs:{id:"alb-concepts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#alb-concepts"}},[t._v("#")]),t._v(" ALB Concepts")]),t._v(" "),s("p",[t._v("Application Load Balancers have a few moving parts that you will need to understand.")]),t._v(" "),s("ul",[s("li",[t._v("The ALB resource itself, which lives in multiple AZs and has a hostname assigned to it")]),t._v(" "),s("li",[t._v("Listeners bound to a port/protocol (e.g. HTTPS on 443) with an associated TLS certificate")]),t._v(" "),s("li",[t._v("Rules tied to a listener that route traffic based on the "),s("code",[t._v("Host")]),t._v(" header")]),t._v(" "),s("li",[t._v("Target groups -- your application -- to deliver the load-balanced traffic to")])]),t._v(" "),s("p",[t._v("ALBs are not able to support an infinite amount of listeners/rules/target groups, so it is important that you create the minimum you require per account. The EACD-CloudOps group will monitor capacity and provision a second shared ALB if/when that becomes necessary.")]),t._v(" "),s("p",[t._v("If your application is running on an AWS service that supports it, instances (ECS tasks, EC2s, etc) can register themselves with the target group. You can statically register instances to the target group as well.")]),t._v(" "),s("p",[t._v("For a standard application in the non-prod environment, you would create:")]),t._v(" "),s("ul",[s("li",[t._v("One listener with one SAN certificate for the dev & qa environments")]),t._v(" "),s("li",[t._v("Two rules, one for each the dev & qa environments")]),t._v(" "),s("li",[t._v("Two target groups, one for each the dev & qa envrionments")])]),t._v(" "),s("p",[t._v("If you need more environments in nonprod, that is fine -- you should still only use one listener.")]),t._v(" "),s("h2",{attrs:{id:"using-the-shared-alb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#using-the-shared-alb"}},[t._v("#")]),t._v(" Using the Shared ALB")]),t._v(" "),s("p",[t._v("Using the shared ALB is a two-step process.")]),t._v(" "),s("p",[t._v("You will need to run a module for the AWS account (nonprod & prod), as well as a per-environment module.")]),t._v(" "),s("h3",{attrs:{id:"per-account"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#per-account"}},[t._v("#")]),t._v(" Per Account")]),t._v(" "),s("p",[t._v("The per-account module will create a listener and certificate, then publish the listener's ARN:")]),t._v(" "),s("div",{staticClass:"language-hcl extra-class"},[s("pre",{pre:!0,attrs:{class:"language-hcl"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data "),s("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"terraform_remote_state"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"account_resources"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("backend")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s3"')]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("config")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("bucket")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.alb_state_bucket\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("key")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.alb_state_file\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("region")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.alb_state_region\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("module"),s("span",{pre:!0,attrs:{class:"token type variable"}},[t._v(' "certificate" ')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The double slash IS significant <https://www.terraform.io/docs/modules/sources.html#modules-in-package-sub-directories>")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("source")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/NIT-Administrative-Systems/AS-Common-AWS-Modules//entapp_certificate?ref=tf-0.12"')]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("hostnames")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my-app-dev.entapp.northwestern.edu"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my-app-qa.entapp.northwestern.edu"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),s("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"aws_lb_listener"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lb_listener"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("load_balancer_arn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" data.terraform_remote_state.account_resources.outputs.lb_arn\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("port")]),t._v("              "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"443"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("protocol")]),t._v("          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HTTPS"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("ssl_policy")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ELBSecurityPolicy-2016-08"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("certificate_arn")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" module.certificate.certificate_arn\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default_action")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("type")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fixed-response"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fixed_response")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("content_type")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text/plain"')]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("message_body")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"No targets are responding to this request."')]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("status_code")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"502"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("output"),s("span",{pre:!0,attrs:{class:"token type variable"}},[t._v(' "alb_listener_arn" ')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("value")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" aws_lb_listener.lb_listener.arn\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"per-environment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#per-environment"}},[t._v("#")]),t._v(" Per Environment")]),t._v(" "),s("p",[t._v("The per-environment module will reference the listener ARN by loading its tfstate as a remote data:")]),t._v(" "),s("div",{staticClass:"language-hcl extra-class"},[s("pre",{pre:!0,attrs:{class:"language-hcl"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Need the VPC ID")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data "),s("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"terraform_remote_state"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"account_resources"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("backend")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s3"')]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("config")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("bucket")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.account_resources_state_bucket\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("key")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.account_resources_state_file\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("region")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.account_resources_state_region\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# For the listener ARN")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data "),s("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"terraform_remote_state"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alb_listener"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("backend")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s3"')]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("config")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("bucket")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.shared_state_bucket\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("key")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.shared_state_file\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("region")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.shared_state_region\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# So TF knows when to re-generate the target group name")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),s("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"random_id"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"target_group_id"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("keepers")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" local.lb_target_group_name\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("vpc_id")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" data.terraform_remote_state.account_resources.outputs.vpc_id\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("target_type")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" local.lb_target_group_target_type\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("byte_length")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),s("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"aws_lb_target_group"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lb_target_group"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" local.lb_target_group_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("-$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("random_id.target_group_id.hex\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("port")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8080"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("protocol")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HTTP"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("deregistration_delay")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.deregistration_delay\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("target_type")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" local.lb_target_group_target_type\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("vpc_id")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" data.terraform_remote_state.account_resources.outputs.vpc_id\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("health_check")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("healthy_threshold")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.hc_healthy_threshold\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("unhealthy_threshold")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.hc_unhealthy_threshold\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("timeout")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.hc_timeout\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("interval")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.hc_interval\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("path")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.hc_path\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("matcher")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.hc_matcher\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lifecycle")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("create_before_destroy")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),s("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"aws_lb_listener_rule"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lb_group_rule"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("listener_arn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" data.terraform_remote_state.alb_listener.outputs.alb_listener_arn\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("action")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("type")]),t._v("             "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"forward"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("target_group_arn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" aws_lb_target_group.lb_target_group.arn\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("condition")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("field")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host-header"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("values")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.hostnames\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# In this example, we're using a Fargate ECS cluster as a target.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Other services support registering with the target group too.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),s("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"aws_ecs_service"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ecs_task_serv"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" local.ecs_task_name\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# . . .")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("load_balancer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("target_group_arn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" aws_lb_target_group.lb_target_group.arn\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("container_name")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" local.container_name\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("container_port")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);