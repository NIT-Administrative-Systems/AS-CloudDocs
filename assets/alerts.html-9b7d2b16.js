import{_ as t,M as o,p,q as i,R as a,t as n,N as e,a1 as r}from"./framework-bf3e1922.js";const c={},l=a("h1",{id:"alerts",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#alerts","aria-hidden":"true"},"#"),n(" Alerts")],-1),u={href:"https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/AlarmThatSendsEmail.html",target:"_blank",rel:"noopener noreferrer"},d={href:"https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/publishingMetrics.html",target:"_blank",rel:"noopener noreferrer"},m={href:"https://docs.aws.amazon.com/lambda/latest/dg/monitoring-metrics.html",target:"_blank",rel:"noopener noreferrer"},k=a("p",null,[n("Beyond alerting, alarms are used to trigger auto-scaling up & down when certain conditions are met. You can attach several actions to an alarm: if auto-scaling is triggered, you can "),a("em",null,"also"),n(" send an OpsGenie alert at the same time.")],-1),v=a("h2",{id:"alerting-to-opsgenie",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#alerting-to-opsgenie","aria-hidden":"true"},"#"),n(" Alerting to OpsGenie")],-1),h={href:"https://docs.opsgenie.com/docs/aws-cloudwatch-integration",target:"_blank",rel:"noopener noreferrer"},_=r(`<p>The EACD-CloudOps team sets up and maintains the SNS topics. They are terraformed as part of the shared account resource IaC module, and the ARNs are published as outputs.</p><p>If you need your OpsGenie team set up, contact EACD-CloudOps. You will need to provide a contact with admin rights to the team so they can add the AWS CloudWatch integration and provide the URL &amp; API key.</p><p>Once set up, you just provide the SNS topic ARN in the <code>alarm_actions</code>. It is recommended to have a flag you can set to disable all of your application&#39;s alerts.</p><p>Here is an example module that alerts when there are &gt;0 failed steps in an AWS Step Function.</p><div class="language-hcl line-numbers-mode" data-ext="hcl"><pre class="language-hcl"><code><span class="token keyword">variable<span class="token type variable"> &quot;alert_on_failure&quot; </span></span><span class="token punctuation">{</span>
    <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
    <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;Whether or not CloudWatch should send alerts via OpsGenie.&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">data <span class="token type variable">&quot;terraform_remote_state&quot;</span></span> <span class="token string">&quot;shared_resources&quot;</span> <span class="token punctuation">{</span>
  <span class="token property">backend</span> <span class="token punctuation">=</span> <span class="token string">&quot;s3&quot;</span>

  <span class="token property">config</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
    <span class="token property">bucket</span> <span class="token punctuation">=</span> var.account_resources_state_bucket
    <span class="token property">key</span>    <span class="token punctuation">=</span> var.account_resources_state_file
    <span class="token property">region</span> <span class="token punctuation">=</span> var.account_resources_state_region
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">&quot;aws_cloudwatch_event_target&quot;</span></span> <span class="token string">&quot;app_runner_target&quot;</span> <span class="token punctuation">{</span>
  <span class="token property">rule</span>     <span class="token punctuation">=</span> aws_cloudwatch_event_rule.app_runner_rule.name
  <span class="token property">arn</span>      <span class="token punctuation">=</span> aws_sfn_state_machine.runner_step_function.id
  <span class="token property">role_arn</span> <span class="token punctuation">=</span> aws_iam_role.step_function_role.arn
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">&quot;aws_cloudwatch_metric_alarm&quot;</span></span> <span class="token string">&quot;failed_executions_alarm&quot;</span> <span class="token punctuation">{</span>
  <span class="token property">alarm_name</span>          <span class="token punctuation">=</span> <span class="token string">&quot;MyFunction-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">env</span><span class="token punctuation">}</span></span>-ExecutionsFailed&quot;</span>
  <span class="token property">comparison_operator</span> <span class="token punctuation">=</span> <span class="token string">&quot;GreaterThanThreshold&quot;</span>
  <span class="token property">evaluation_periods</span>  <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span>
  <span class="token property">metric_name</span>         <span class="token punctuation">=</span> <span class="token string">&quot;ExecutionsFailed&quot;</span>
  <span class="token property">namespace</span>           <span class="token punctuation">=</span> <span class="token string">&quot;AWS/States&quot;</span>
  <span class="token property">period</span>              <span class="token punctuation">=</span> <span class="token string">&quot;120&quot;</span>
  <span class="token property">statistic</span>           <span class="token punctuation">=</span> <span class="token string">&quot;Sum&quot;</span>
  <span class="token property">threshold</span>           <span class="token punctuation">=</span> <span class="token string">&quot;0&quot;</span>
  <span class="token property">alarm_description</span>   <span class="token punctuation">=</span> <span class="token string">&quot;Monitors for MyFunction <span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">env</span><span class="token punctuation">}</span></span> step function errors.&quot;</span>
  <span class="token property">treat_missing_data</span>  <span class="token punctuation">=</span> <span class="token string">&quot;ignore&quot;</span>
  <span class="token property">actions_enabled</span>     <span class="token punctuation">=</span> var.alert_on_failure
  <span class="token property">alarm_actions</span>       <span class="token punctuation">=</span> <span class="token punctuation">[</span>data.terraform_remote_state.shared_resources.outputs.opsgenie_team_sns_arns.eacd<span class="token punctuation">]</span>

  <span class="token property">dimensions</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
    <span class="token property">StateMachineArn</span> <span class="token punctuation">=</span> aws_sfn_state_machine.runner_step_function.id
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5);function b(g,y){const s=o("ExternalLinkIcon");return p(),i("div",null,[l,a("p",null,[n("AWS CloudWatch collects metrics and logs from your application & infrastructure. You can configure "),a("a",u,[n("alarms"),e(s)]),n(" based on AWS' built-in metrics, "),a("a",d,[n("custom metrics your app reports to CloudWatch"),e(s)]),n(", forecasts (powered by machine learning), or a combination of all three. These alarms can trigger alerts in OpsGenie.")]),a("p",null,[n("The available metrics vary between AWS products, and most products should have a section in their documentation that explains what metrics are available. For example, "),a("a",m,[n("Lambda has metrics"),e(s)]),n(" for invocations, run time, and concurrent executions.")]),k,v,a("p",null,[n("CloudWatch alarms can be dispatched to an SNS topic, which can make API calls. The OpsGenie API supports automatic approval to receive data from SNS by way of its "),a("a",h,[n("AWS integration"),e(s)]),n(".")]),_])}const q=t(c,[["render",b],["__file","alerts.html.vue"]]);export{q as default};
