<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Jenkins Pipelines | AS Cloud Docs</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link href="https://common.northwestern.edu/v8/icons/favicon-16.png" rel="icon" sizes="16x16" type="image/png">
    <link href="https://common.northwestern.edu/v8/icons/favicon-32.png" rel="icon" sizes="32x32" type="image/png">
    <meta name="description" content="Docs for Northwestern IT staff on our cloud implementation.">
    <link rel="preload" href="/AS-CloudDocs/assets/css/0.styles.66b7ce55.css" as="style"><link rel="preload" href="/AS-CloudDocs/assets/js/app.7c4b6c5b.js" as="script"><link rel="preload" href="/AS-CloudDocs/assets/js/2.542323c2.js" as="script"><link rel="preload" href="/AS-CloudDocs/assets/js/7.756be9c0.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/js/10.9c3425ea.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/11.ac0cecc6.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/12.6bd0e6ba.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/13.9ca59192.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/14.e57694b1.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/15.89cc6230.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/16.e55c84ba.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/17.4c7d7f3a.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/18.7afbb7e8.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/19.c0166409.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/20.3d997d9c.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/21.9c8b6104.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/22.6436862a.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/23.4fc19cec.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/24.7df3799d.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/25.61a7df8a.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/26.7558c1a5.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/27.63bd6ea2.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/28.055ebb0b.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/29.a5382a9b.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/3.f29b8e39.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/30.f9ce488b.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/31.26a400c3.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/32.c770c34a.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/33.8f326431.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/34.84ff26a4.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/35.75b0d681.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/36.1e82fcff.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/37.1b4b47bf.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/38.431607e7.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/39.70913066.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/4.0eba8a6a.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/40.343909fa.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/41.dc1656de.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/42.5d3404e4.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/43.c442575a.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/44.e29015d5.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/5.7da5a2df.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/6.1247cfd9.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/8.82adb3b5.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/9.40a788ea.js">
    <link rel="stylesheet" href="/AS-CloudDocs/assets/css/0.styles.66b7ce55.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/AS-CloudDocs/" class="home-link router-link-active"><!----> <span class="site-name">AS Cloud Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/NIT-Administrative-Systems/AS-CloudDocs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/NIT-Administrative-Systems/AS-CloudDocs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Introduction</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/" aria-current="page" class="sidebar-link">Overview</a></li><li><a href="/AS-CloudDocs/roles-responsibilities.html" class="sidebar-link">Roles &amp; Responsibilities</a></li><li><a href="/AS-CloudDocs/design-for-cloud.html" class="sidebar-link">Designing Apps for the Cloud</a></li><li><a href="/AS-CloudDocs/tools.html" class="sidebar-link">Tool Recommendations</a></li><li><a href="/AS-CloudDocs/docs-site.html" class="sidebar-link">Documentation Site</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Infrastructure</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/infrastructure/aws-account-design.html" class="sidebar-link">AWS Account Structure</a></li><li><a href="/AS-CloudDocs/infrastructure/tagging.html" class="sidebar-link">Tagging Resources</a></li><li><a href="/AS-CloudDocs/infrastructure/vpc-ip-addr.html" class="sidebar-link">VPCs &amp; IP Addressing</a></li><li><a href="/AS-CloudDocs/infrastructure/alb.html" class="sidebar-link">Application Load Balancers</a></li><li><a href="/AS-CloudDocs/infrastructure/certificates.html" class="sidebar-link">Certificates</a></li><li><a href="/AS-CloudDocs/infrastructure/api-gateway.html" class="sidebar-link">API Gateway</a></li><li><a href="/AS-CloudDocs/infrastructure/lambda.html" class="sidebar-link">Lambda</a></li><li><a href="/AS-CloudDocs/infrastructure/ecs-fargate.html" class="sidebar-link">Fargate for ECS</a></li><li><a href="/AS-CloudDocs/infrastructure/ses.html" class="sidebar-link">Simple Email Service (SES)</a></li><li><a href="/AS-CloudDocs/infrastructure/iam.html" class="sidebar-link">Identity &amp; Access Management (IAM)</a></li><li><a href="/AS-CloudDocs/infrastructure/databases.html" class="sidebar-link">Databases</a></li><li><a href="/AS-CloudDocs/infrastructure/secrets.html" class="sidebar-link">Secret Management</a></li><li><a href="/AS-CloudDocs/infrastructure/alerts.html" class="sidebar-link">Alerts</a></li><li><a href="/AS-CloudDocs/infrastructure/cloudfront.html" class="sidebar-link">CloudFront CDN</a></li><li><a href="/AS-CloudDocs/infrastructure/vapor.html" class="sidebar-link">Laravel Vapor</a></li><li><a href="/AS-CloudDocs/infrastructure/aws-service-scheduler.html" class="sidebar-link">AWS Service Scheduler</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Infrastructure as Code</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/iac/terraform-concepts.html" class="sidebar-link">Terraform</a></li><li><a href="/AS-CloudDocs/iac/as-tf-modules.html" class="sidebar-link">AS Terraform Modules</a></li><li><a href="/AS-CloudDocs/iac/example-tf.html" class="sidebar-link">Example Terraform Module</a></li><li><a href="/AS-CloudDocs/iac/available-modules.html" class="sidebar-link">Available Modules</a></li><li><a href="/AS-CloudDocs/iac/state-buckets.html" class="sidebar-link">State Bucket Reference</a></li><li><a href="/AS-CloudDocs/iac/tf-import.html" class="sidebar-link">Terraform Import</a></li><li><a href="/AS-CloudDocs/iac/tf-move.html" class="sidebar-link">Terraform State Move</a></li><li><a href="/AS-CloudDocs/iac/tf-upgrading.html" class="sidebar-link">Upgrading Terraform</a></li><li><a href="/AS-CloudDocs/iac/faq.html" class="sidebar-link">Frequently Asked Questions</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>CI &amp; CD</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/ci-cd/jenkins.html" aria-current="page" class="active sidebar-link">Jenkins Pipelines</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/AS-CloudDocs/ci-cd/jenkins.html#accessing-github-repositories" class="sidebar-link">Accessing GitHub Repositories</a></li><li class="sidebar-sub-header"><a href="/AS-CloudDocs/ci-cd/jenkins.html#configuration" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/AS-CloudDocs/ci-cd/jenkins.html#credentials" class="sidebar-link">Credentials</a></li><li class="sidebar-sub-header"><a href="/AS-CloudDocs/ci-cd/jenkins.html#agents" class="sidebar-link">Agents</a></li><li class="sidebar-sub-header"><a href="/AS-CloudDocs/ci-cd/jenkins.html#example-pipeline" class="sidebar-link">Example Pipeline</a></li><li class="sidebar-sub-header"><a href="/AS-CloudDocs/ci-cd/jenkins.html#scheduling-deployments" class="sidebar-link">Scheduling Deployments</a></li></ul></li><li><a href="/AS-CloudDocs/ci-cd/shared-libs.html" class="sidebar-link">Shared Library</a></li><li><a href="/AS-CloudDocs/ci-cd/jenkins-ecs-agent.html" class="sidebar-link">Jenkins ECS Agent</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Application Development</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/development/principles.html" class="sidebar-link">Design Principles</a></li><li><a href="/AS-CloudDocs/development/app-patterns.html" class="sidebar-link">Application Patterns</a></li><li><a href="/AS-CloudDocs/development/libraries.html" class="sidebar-link">Packages &amp; Libraries</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>GitHub</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/github/settings-permissions.html" class="sidebar-link">Settings &amp; Permissions</a></li><li><a href="/AS-CloudDocs/github/repo-layout.html" class="sidebar-link">Repository Structure</a></li><li><a href="/AS-CloudDocs/github/workflow.html" class="sidebar-link">Workflow</a></li><li><a href="/AS-CloudDocs/github/policies.html" class="sidebar-link">Policy</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jenkins-pipelines"><a href="#jenkins-pipelines" class="header-anchor">#</a> Jenkins Pipelines</h1> <p>A Jenkins pipeline is a script that takes your application from version control to deployment. The pipeline file is kept in your application's Github repository, follows normal pull request review procedure, and is promoted from dev/qa/prod using the same process as your code.</p> <p>Jenkins pipelines have several flavours. Unless you have reason to deviate, our standards are multi-branch declarative pipelines. Multi-branch pipelines will detect all branches &amp; pull requests and run them inside the &quot;parent&quot; job: perfect for running tests or deploying dev/qa environments. There may be cases where this is <em>not</em> appropriate, such as a pipeline that runs on a schedule and kicks off a scheduled deployment.</p> <p>Documentation on the declarative Jenkinsfile syntax can be found <a href="https://jenkins.io/doc/book/pipeline/syntax/" target="_blank" rel="noopener noreferrer">on the Jenkins website<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <div class="custom-block warning"><p class="custom-block-title">Legacy Jenkins Jobs</p> <p>If you have used Jenkins in the past, you may be familiar with configuring jobs.</p> <p>These legacy-style jobs should be replaced by pipelines files kept in version control. No new jobs should be configured this way.</p></div> <p>We typically keep pipeline files in a <code>.jenkins/</code> folder. Even if you only have a single Jenkinsfile, it is advisable to put it in the folder; changing it later is a nuisance.</p> <h2 id="accessing-github-repositories"><a href="#accessing-github-repositories" class="header-anchor">#</a> Accessing GitHub Repositories</h2> <p>Jenkins must authenticate to GitHub.com as a user in order to clone code. This user must be a collaborator on the repository that you want Jenkins to work with.</p> <p>All Jenkins servers have the <a href="#credentials"><code>GitHub-awsCloudOpsCJT</code></a> credential for the <a href="https://github.com/awsCloudOpsCJT" target="_blank" rel="noopener noreferrer">awsCloudOpsCJT user<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> that may be used. You may create a user specifically for your team if you want to more tightly control access to your repositories. Creating a team-specific user is recommended if you will be granting it write permission so Jenkins can update <a href="https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/about-status-checks" target="_blank" rel="noopener noreferrer">commit statuses<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>If you need awsCloudOpsCJT or a team-specific user added as a collaborator, contact the EACD-CloudOps group -- self-service tooling for this is not available yet, sorry!</p> <h2 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h2> <p>As much configuration as possible should be included in the Jenkinsfile.</p> <ul><li>Review the <a href="https://jenkins.io/doc/book/pipeline/syntax/#options" target="_blank" rel="noopener noreferrer">options<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> section
<ul><li><code>disableConcurrentBuilds()</code> is a commonly-used option; you wouldn't want to <code>terraform apply</code> off the same tfstate file at the same time.</li></ul></li> <li>Review the <a href="https://jenkins.io/doc/book/pipeline/syntax/#triggers" target="_blank" rel="noopener noreferrer">triggers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> section
<ul><li><code>pollSCM('H/10 * * * *')</code> is popular; Jenkins is firewalled off so Github cannot notify it when code is pushed</li></ul></li> <li>Review the <a href="https://jenkins.io/doc/book/pipeline/syntax/#parameters" target="_blank" rel="noopener noreferrer">parameters<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> section, if you need inputs</li></ul> <p>The most notable item that you cannot include is branch discovery for a multi-branch pipeline. This must be configured in the Jenkins UI:</p> <p><img src="/AS-CloudDocs/assets/img/branch-discovery.a640c64b.png" alt="Branch discovery settings"></p> <h2 id="credentials"><a href="#credentials" class="header-anchor">#</a> Credentials</h2> <p>Jenkins has a credential store that your pipelines may access. These credentials are items necessary for deployments.</p> <p>Out of the box, three credentials will exist:</p> <ul><li><code>terraform</code>, an AWS credential for creating resources via Terraform</li> <li><code>teams-build-webhook</code>, the URL for posting status messages to Teams</li> <li><code>GitHub-awsCloudOpsCJT</code>, a Github user in our organization</li></ul> <p>You can ask the EACD-CloudOps group for help if you need to add pipeline-specific secrets to your Jenkins servers.</p> <h2 id="agents"><a href="#agents" class="header-anchor">#</a> Agents</h2> <p>By default, a pipeline will run on the main Jenkins server. It will have the tools available on a fairly standard CentOS Linux installation, plus the <code>terraform</code> binary and docker CLI tools.</p> <p>If you need more specialized tools -- specific versions of NodeJS for example -- you can use a Docker agent instead:</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>agent <span class="token punctuation">{</span>
    docker <span class="token punctuation">{</span>
        image <span class="token string">'node:10'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can choose an agent for your pipeline file or for specific stages. Jenkins will download the Docker image from Docker Hub and execute your pipeline inside of that container. If no community-maintained image is available for your needs, you can write your own Dockerfile and use it as the agent as well.</p> <h3 id="heavy-tasks"><a href="#heavy-tasks" class="header-anchor">#</a> Heavy Tasks</h3> <p>For small units of work, running things on the Jenkins server is fine. However, when running more computationally-expensive pipelines, you are liable to consume all available CPU/memory. Jenkins may become unresponsive, unable to run additional tasks, or crash.</p> <p>Instructions on offloading to dedicated worker hosts can be found in the <a href="/AS-CloudDocs/ci-cd/jenkins-ecs-agent.html">Jenkins ECS Agent</a> article. The EACD-CloudOps group may request you convert some pipeline(s) to using an ECS agent as problems are discovered.</p> <h2 id="example-pipeline"><a href="#example-pipeline" class="header-anchor">#</a> Example Pipeline</h2> <p>This is an example pipeline for testing a PHP 7.4 application. The entire pipeline runs in a community-maintained Docker image pulled in from Docker Hub. Jenkins will scan GitHub for any new commits every 10 minutes, and kick the pipeline off for any new/changed branches. When it runs, it will ping a Teams channel. If the build succeeds or fails, a follow-up will be posted to Teams.</p> <p>The very first line (<code>#!groovy</code>) is a trick we use to get correct syntax highlighting in VSCode. It has no other effect.</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token shebang comment">#!groovy</span>
pipeline <span class="token punctuation">{</span>
    agent <span class="token punctuation">{</span>
        docker <span class="token punctuation">{</span>
            image <span class="token string">'edbizarro/gitlab-ci-pipeline-php:7.4'</span>
            args <span class="token string">'-u root:root'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    environment <span class="token punctuation">{</span>
        TEAMS_WEBHOOK_URL <span class="token operator">=</span> <span class="token function">credentials</span><span class="token punctuation">(</span><span class="token string">'teams-build-webhook'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    triggers <span class="token punctuation">{</span>
        <span class="token function">pollSCM</span><span class="token punctuation">(</span><span class="token string">'H/10 * * * *'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>


    options <span class="token punctuation">{</span>
        <span class="token function">disableConcurrentBuilds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    stages <span class="token punctuation">{</span>
        stage <span class="token punctuation">(</span><span class="token string">'Send Notifications'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                office365ConnectorSend status<span class="token punctuation">:</span> <span class="token string gstring">&quot;Started&quot;</span><span class="token punctuation">,</span> webhookUrl<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>env<span class="token punctuation">.</span>TEAMS_WEBHOOK_URL<span class="token punctuation">}</span></span>&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stages <span class="token punctuation">{</span>
            stage <span class="token punctuation">(</span><span class="token string">'Test'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                steps <span class="token punctuation">{</span>
                    sh <span class="token string">'composer install'</span>
                    sh <span class="token string">'./vendor/bin/phpunit'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    post <span class="token punctuation">{</span>
        success <span class="token punctuation">{</span>
            office365ConnectorSend status<span class="token punctuation">:</span> <span class="token string gstring">&quot;Success!&quot;</span><span class="token punctuation">,</span> webhookUrl<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>env<span class="token punctuation">.</span>TEAMS_WEBHOOK_URL<span class="token punctuation">}</span></span>&quot;</span>
        <span class="token punctuation">}</span>

        failure <span class="token punctuation">{</span>
            office365ConnectorSend status<span class="token punctuation">:</span> <span class="token string gstring">&quot;Failed&quot;</span><span class="token punctuation">,</span> webhookUrl<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>env<span class="token punctuation">.</span>TEAMS_WEBHOOK_URL<span class="token punctuation">}</span></span>&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="scheduling-deployments"><a href="#scheduling-deployments" class="header-anchor">#</a> Scheduling Deployments</h2> <p>You must regularly re-deploy your application. Our minimum is once per week, but more frequent deployments are encouraged.</p> <p>Re-deploying on a schedule, even when no changes are pending deployment, ensures that your pipeline &amp; deployment process is valid. Some applications may go into a period of development inactivity; it's good to know that you can apply a critical security patch without worrying if your pipeline still works after not being used for nine months.</p> <p>You can create a pair of regular (not multi-branch) pipelines that trigger your main Jenkinsfile's develop/qa &amp; production branch builds.</p> <p>Here is an example Jenkinsfile that will schedule itself to run every day at noon. When it runs, it will trigger a build for the <code>develop</code> branch in the <code>OnBase SSO Shim</code> multi-branch pipeline. This way, it's using the exact same deployment process as when changes are pushed to <code>develop</code>. Once that run is done, it will do the same for the <code>qa</code> branch:</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token shebang comment">#!groovy</span>
pipeline <span class="token punctuation">{</span>
    agent any

    triggers <span class="token punctuation">{</span>
        <span class="token function">cron</span><span class="token punctuation">(</span><span class="token string">'H 12 * * *'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    stages <span class="token punctuation">{</span>
        stage <span class="token punctuation">(</span><span class="token string">'Deploy Sub-production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">build</span><span class="token punctuation">(</span>job<span class="token punctuation">:</span> <span class="token string">'OnBase SSO Shim/develop'</span><span class="token punctuation">)</span>
                <span class="token function">build</span><span class="token punctuation">(</span>job<span class="token punctuation">:</span> <span class="token string">'OnBase SSO Shim/qa'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/NIT-Administrative-Systems/AS-CloudDocs/edit/stable/ci-cd/jenkins.md" target="_blank" rel="noopener noreferrer">Edit Page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/17/2021, 5:11:00 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/AS-CloudDocs/iac/faq.html" class="prev">
        Frequently Asked Questions
      </a></span> <span class="next"><a href="/AS-CloudDocs/ci-cd/shared-libs.html">
        Shared Library
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/AS-CloudDocs/assets/js/app.7c4b6c5b.js" defer></script><script src="/AS-CloudDocs/assets/js/2.542323c2.js" defer></script><script src="/AS-CloudDocs/assets/js/7.756be9c0.js" defer></script>
  </body>
</html>
