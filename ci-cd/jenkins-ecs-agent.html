<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Jenkins ECS Agent | AS Cloud Docs</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link href="https://common.northwestern.edu/v8/icons/favicon-16.png" rel="icon" sizes="16x16" type="image/png">
    <link href="https://common.northwestern.edu/v8/icons/favicon-32.png" rel="icon" sizes="32x32" type="image/png">
    <meta name="description" content="Docs for Northwestern IT staff on our cloud implementation.">
    
    <link rel="preload" href="/AS-CloudDocs/assets/css/0.styles.425dfd68.css" as="style"><link rel="preload" href="/AS-CloudDocs/assets/js/app.cb8b285d.js" as="script"><link rel="preload" href="/AS-CloudDocs/assets/js/2.1981cd55.js" as="script"><link rel="preload" href="/AS-CloudDocs/assets/js/17.a6e8ee7c.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/js/10.b7cfc97a.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/11.7378bf22.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/12.047b92b2.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/13.70e76045.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/14.ba329726.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/15.b322c67e.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/16.1997f2bd.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/18.d93e4e1f.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/19.e60f9086.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/20.737bf283.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/21.cb65b659.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/22.8cbb4304.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/23.3e867935.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/24.d5b9e77d.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/25.62d311e1.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/26.b440abaf.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/27.c08e6665.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/28.9289f829.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/29.16e81cef.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/3.3e038af8.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/30.9c748ad1.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/31.19536c2e.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/32.c9f88a51.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/33.a8e7cf7d.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/34.dd0f5218.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/35.1fe2101b.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/36.cbafddcb.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/37.d85a776b.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/38.143ac759.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/39.a4477bbe.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/4.fd8a9d0a.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/40.9d3b864b.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/41.63da38ab.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/42.fcf0be8c.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/43.35a2833a.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/44.bc138650.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/45.f9131314.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/46.ca5e23a2.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/47.81742c32.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/48.e97407c7.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/49.8b3aa094.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/5.f8165a6e.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/50.64c608db.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/51.370f3c89.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/52.28450ca3.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/6.fca2af09.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/7.2bff0867.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/8.f718a08e.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/9.e11d18ec.js">
    <link rel="stylesheet" href="/AS-CloudDocs/assets/css/0.styles.425dfd68.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/AS-CloudDocs/" class="home-link router-link-active"><!----> <span class="site-name">AS Cloud Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/NIT-Administrative-Systems/AS-CloudDocs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/NIT-Administrative-Systems/AS-CloudDocs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Introduction</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/" aria-current="page" class="sidebar-link">Overview</a></li><li><a href="/AS-CloudDocs/roles-responsibilities.html" class="sidebar-link">Roles &amp; Responsibilities</a></li><li><a href="/AS-CloudDocs/design-for-cloud.html" class="sidebar-link">Designing Apps for the Cloud</a></li><li><a href="/AS-CloudDocs/tools.html" class="sidebar-link">Tool Recommendations</a></li><li><a href="/AS-CloudDocs/docs-site.html" class="sidebar-link">Documentation Site</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Infrastructure</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/infrastructure/aws-account-design.html" class="sidebar-link">AWS Account Structure</a></li><li><a href="/AS-CloudDocs/infrastructure/tagging.html" class="sidebar-link">Tagging Resources</a></li><li><a href="/AS-CloudDocs/infrastructure/vpc-ip-addr.html" class="sidebar-link">VPCs &amp; IP Addressing</a></li><li><a href="/AS-CloudDocs/infrastructure/alb.html" class="sidebar-link">Application Load Balancers</a></li><li><a href="/AS-CloudDocs/infrastructure/certificates.html" class="sidebar-link">Certificates</a></li><li><a href="/AS-CloudDocs/infrastructure/api-gateway.html" class="sidebar-link">API Gateway</a></li><li><a href="/AS-CloudDocs/infrastructure/lambda.html" class="sidebar-link">Lambda</a></li><li><a href="/AS-CloudDocs/infrastructure/ecs-fargate.html" class="sidebar-link">Fargate for ECS</a></li><li><a href="/AS-CloudDocs/infrastructure/ses.html" class="sidebar-link">Simple Email Service (SES)</a></li><li><a href="/AS-CloudDocs/infrastructure/iam.html" class="sidebar-link">Identity &amp; Access Management (IAM)</a></li><li><a href="/AS-CloudDocs/infrastructure/databases.html" class="sidebar-link">Databases</a></li><li><a href="/AS-CloudDocs/infrastructure/secrets.html" class="sidebar-link">Secret Management</a></li><li><a href="/AS-CloudDocs/infrastructure/alerts.html" class="sidebar-link">Alerts</a></li><li><a href="/AS-CloudDocs/infrastructure/cloudfront.html" class="sidebar-link">CloudFront CDN</a></li><li><a href="/AS-CloudDocs/infrastructure/vapor.html" class="sidebar-link">Laravel Vapor</a></li><li><a href="/AS-CloudDocs/infrastructure/aws-service-scheduler.html" class="sidebar-link">AWS Service Scheduler</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Infrastructure as Code</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/iac/terraform-concepts.html" class="sidebar-link">Terraform</a></li><li><a href="/AS-CloudDocs/iac/as-tf-modules.html" class="sidebar-link">AS Terraform Modules</a></li><li><a href="/AS-CloudDocs/iac/example-tf.html" class="sidebar-link">Example Terraform Module</a></li><li><a href="/AS-CloudDocs/iac/available-modules.html" class="sidebar-link">Available Modules</a></li><li><a href="/AS-CloudDocs/iac/state-buckets.html" class="sidebar-link">State Bucket Reference</a></li><li><a href="/AS-CloudDocs/iac/tf-import.html" class="sidebar-link">Terraform Import</a></li><li><a href="/AS-CloudDocs/iac/tf-move.html" class="sidebar-link">Terraform State Move</a></li><li><a href="/AS-CloudDocs/iac/tf-upgrading.html" class="sidebar-link">Upgrading Terraform</a></li><li><a href="/AS-CloudDocs/iac/faq.html" class="sidebar-link">Frequently Asked Questions</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>CI &amp; CD</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/ci-cd/jenkins.html" class="sidebar-link">Jenkins Pipelines</a></li><li><a href="/AS-CloudDocs/ci-cd/shared-libs.html" class="sidebar-link">Shared Library</a></li><li><a href="/AS-CloudDocs/ci-cd/jenkins-ecs-agent.html" aria-current="page" class="active sidebar-link">Jenkins ECS Agent</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/AS-CloudDocs/ci-cd/jenkins-ecs-agent.html#using-ecs-agent" class="sidebar-link">Using ECS Agent</a></li><li class="sidebar-sub-header"><a href="/AS-CloudDocs/ci-cd/jenkins-ecs-agent.html#adding-jenkins-jnlp-agent-to-docker-image" class="sidebar-link">Adding Jenkins JNLP Agent to Docker image</a></li></ul></li><li><a href="/AS-CloudDocs/ci-cd/gha.html" class="sidebar-link">GitHub Actions</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Application Development</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/development/principles.html" class="sidebar-link">Design Principles</a></li><li><a href="/AS-CloudDocs/development/app-patterns.html" class="sidebar-link">Application Patterns</a></li><li><a href="/AS-CloudDocs/development/laravel-stack.html" class="sidebar-link">Laravel Stack</a></li><li><a href="/AS-CloudDocs/development/express-stack.html" class="sidebar-link">ExpressJS Stack</a></li><li><a href="/AS-CloudDocs/development/spring-stack.html" class="sidebar-link">Spring Stack</a></li><li><a href="/AS-CloudDocs/development/frontend-stacks.html" class="sidebar-link">Frontend Stacks</a></li><li><a href="/AS-CloudDocs/development/libraries.html" class="sidebar-link">Packages &amp; Libraries</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Security</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/security/sso-approaches.html" class="sidebar-link">Single Sign-on</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>GitHub</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/github/settings-permissions.html" class="sidebar-link">Settings &amp; Permissions</a></li><li><a href="/AS-CloudDocs/github/repo-layout.html" class="sidebar-link">Repository Structure</a></li><li><a href="/AS-CloudDocs/github/workflow.html" class="sidebar-link">Workflow</a></li><li><a href="/AS-CloudDocs/github/policies.html" class="sidebar-link">Policy</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jenkins-ecs-agent"><a href="#jenkins-ecs-agent" class="header-anchor">#</a> Jenkins ECS Agent</h1> <p>With the <a href="https://github.com/jenkinsci/amazon-ecs-plugin" target="_blank" rel="noopener noreferrer">Elastic Container Plugin agent for Jenkins<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, the work involved in running a Jenkins pipeline (partially or entirely) can be offloaded from the primary Jenkins server to remote compute spun up on-demand. When the pipeline is done running, the compute will be torn down.</p> <p>For our implementation, we have chosen ECS Fargate. We do not maintain the EC2s or much infrastructure -- we just ask AWS to run a Docker image in our VPC with a specific amount of CPU/memory.</p> <ul><li><p><strong>Pro</strong></p> <ul><li>Only billed for the compute we need; no EC2s sitting around idling</li> <li>Rogue jobs filling up disk / using all available CPU/memory will not impact other jobs or crash Jenkins</li> <li>Can get more CPU/memory than the priamry Jenkins server has available</li></ul></li> <li><p><strong>Con</strong></p> <ul><li>Pipeline takes longer to start; has to wait for compute to spin up</li> <li>Requires JNLP-enabled Docker images; mostly have to write &amp; maintain ourselves</li> <li>ECS Agent plugin <a href="https://github.com/jenkinsci/amazon-ecs-plugin/issues/138" target="_blank" rel="noopener noreferrer">does not currently support Fargate Spot market<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul> <h2 id="using-ecs-agent"><a href="#using-ecs-agent" class="header-anchor">#</a> Using ECS Agent</h2> <p>If you want to use a remote ECS agent, you should adjust the <code>agent</code> block in your pipeline.</p> <div class="custom-block warning"><p class="custom-block-title">Work in Progress</p> <p>This implementation is a work in progress. It is available in the ADO Jenkins environments.</p> <p>Please contact EACD for a current list of applicable <code>inheritFrom</code> containers. We are working to get the Docker image used under dev control.</p></div> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token shebang comment">#!groovy</span>
pipeline <span class="token punctuation">{</span>
    agent <span class="token punctuation">{</span>
        ecs <span class="token punctuation">{</span>
            inheritFrom <span class="token string">'jenkins-workers-php'</span>
            cpu <span class="token number">2048</span>
            memoryReservation <span class="token number">4096</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    stages <span class="token punctuation">{</span>
        stage <span class="token punctuation">(</span><span class="token string">'Do stuff'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                sh <span class="token string">'yarn install'</span>
                sh <span class="token string">'...'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You may override any of the ECS plugin's settings. For a list of available settings, see <a href="https://github.com/jenkinsci/amazon-ecs-plugin/blob/master/src/main/java/com/cloudbees/jenkins/plugins/amazonecs/pipeline/ECSDeclarativeAgent.java#L28" target="_blank" rel="noopener noreferrer">the properties for ECSDeclarativeAgent<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>You <strong>cannot</strong> pick totally-arbitrary values for CPU/memory. ECS Fargate has an upper bound on how much memory is available based on the CPU shares requested. See Fargate documentation for <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/AWS_Fargate.html#fargate-tasks-size" target="_blank" rel="noopener noreferrer">a list of valid CPU/memory size combinations<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="custom-block tip"><p class="custom-block-title">Accessing On-Prem Resources</p> <p>The remote ECS agents will run in the same subnet that the primary Jenkins server lives in.</p> <p>If you need to access secure on-campus resources, submit your firewall requests using the subnet instead of the server's individual IP.</p></div> <p>As with any other Jenkins pipeline, you may choose a different agent in an individual stage block.</p> <h3 id="troubleshooting"><a href="#troubleshooting" class="header-anchor">#</a> Troubleshooting</h3> <p>If you are having problems using ECS remote workers, first check the log for the run in Jenkins. It will indicate if any pipeline errors have occurred.</p> <p>If that log does not give you an indication of the issue, log in to your AWS account and check the <code>jenkins-workers</code> ECS cluster. You can see if your task is pending or active, which indicate it's still running. You can search for stopped tasks as well. Their logs may include useful error messages.</p> <p>If you do not see an ECS task being queued at all when you run the pipeline, it is possible the API call to create the ECS task is failing. Double-check your <code>cpu</code>/<code>memoryReservation</code> combination is valid. If it is, contact the EACD or PIPS-CloudOps teams and ask them to review the Jenkins server logs -- AWS API errors are only made available in this logfile.</p> <h2 id="adding-jenkins-jnlp-agent-to-docker-image"><a href="#adding-jenkins-jnlp-agent-to-docker-image" class="header-anchor">#</a> Adding Jenkins JNLP Agent to Docker image</h2> <p>To use a Docker image as an ECS remote worker, it will need the Jenkins JNLP agent installed and configured as the entrypoint.</p> <p>Select a suitable base Docker image to extend that includes the language/tool versions you want. You can find an image on Dockerhub, or write your own.</p> <h3 id="debian-images"><a href="#debian-images" class="header-anchor">#</a> Debian Images</h3> <p>This is an example of setting up Java &amp; the agent for a PHP environment maintained by the Gitlab community. Their docker image is a Debian-based system that uses <code>apt</code>.</p> <div class="language-docker extra-class"><pre class="language-docker"><code><span class="token keyword">FROM</span> edbizarro/gitlab<span class="token punctuation">-</span>ci<span class="token punctuation">-</span>pipeline<span class="token punctuation">-</span>php<span class="token punctuation">:</span>7.2

<span class="token comment">## Install the Jenkins agent on a Debian-family image</span>
<span class="token keyword">USER</span> root <span class="token comment"># Extended image may leave us as an unpriviledged user</span>

<span class="token comment"># https://github.com/geerlingguy/ansible-role-java/issues/64</span>
<span class="token keyword">RUN</span> mkdir <span class="token punctuation">-</span>p /usr/share/man/man1

<span class="token keyword">RUN</span> DEBIAN_FRONTEND=noninteractive apt<span class="token punctuation">-</span>get update <span class="token comment"># fetch package lists</span>
<span class="token keyword">RUN</span> DEBIAN_FRONTEND=noninteractive apt<span class="token punctuation">-</span>get install <span class="token punctuation">-</span>yqq apt<span class="token punctuation">-</span>utils default<span class="token punctuation">-</span>jre <span class="token comment"># install Java runtime</span>

 <span class="token comment"># Copy agent JARs from official Jenkins worker images </span>
<span class="token keyword">COPY</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>from=jenkins/slave<span class="token punctuation">:</span>latest /usr/share/jenkins/agent.jar /usr/share/jenkins/agent.jar
<span class="token keyword">COPY</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>from=jenkins/jnlp<span class="token punctuation">-</span>slave<span class="token punctuation">:</span>latest /usr/local/bin/jenkins<span class="token punctuation">-</span>agent /usr/bin/jenkins<span class="token punctuation">-</span>agent

<span class="token keyword">RUN</span> chmod +x /usr/bin/jenkins<span class="token punctuation">-</span>agent &amp;&amp; ln <span class="token punctuation">-</span>s /usr/bin/jenkins<span class="token punctuation">-</span>agent /usr/bin/jenkins<span class="token punctuation">-</span>slave

<span class="token comment"># Create workspace for Jenkins to use.</span>
<span class="token comment"># The `php` user is something from the extended image -- an unprivledges user.</span>
<span class="token keyword">RUN</span> mkdir /home/jenkins
<span class="token keyword">RUN</span> chown php<span class="token punctuation">:</span>php /home/jenkins

<span class="token keyword">WORKDIR</span> /home/jenkins

<span class="token comment"># Launch w/ the Jenkins agent JAR</span>
<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">&quot;jenkins-agent&quot;</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="alpine-linux"><a href="#alpine-linux" class="header-anchor">#</a> Alpine Linux</h3> <p>Alpine Linux is a minamalist Linux distribution. It is popular in the Docker community, since the minimalism keeps image size down.</p> <div class="custom-block warning"><p class="custom-block-title">TODO</p> <p>We don't have an alpine example yet.</p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/NIT-Administrative-Systems/AS-CloudDocs/edit/stable/ci-cd/jenkins-ecs-agent.md" target="_blank" rel="noopener noreferrer">Edit Page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/25/2022, 4:05:45 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/AS-CloudDocs/ci-cd/shared-libs.html" class="prev">
        Shared Library
      </a></span> <span class="next"><a href="/AS-CloudDocs/ci-cd/gha.html">
        GitHub Actions
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/AS-CloudDocs/assets/js/app.cb8b285d.js" defer></script><script src="/AS-CloudDocs/assets/js/2.1981cd55.js" defer></script><script src="/AS-CloudDocs/assets/js/17.a6e8ee7c.js" defer></script>
  </body>
</html>
