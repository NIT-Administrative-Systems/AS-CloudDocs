<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.60">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link href="https://common.northwestern.edu/v8/icons/favicon-16.png" rel="icon" sizes="16x16" type="image/png"><link href="https://common.northwestern.edu/v8/icons/favicon-32.png" rel="icon" sizes="32x32" type="image/png"><title>Upgrading Terraform | AS Cloud Docs</title><meta name="description" content="Docs for Northwestern IT staff on our cloud implementation.">
    <link rel="preload" href="/AS-CloudDocs/assets/style-8d9bb470.css" as="style"><link rel="stylesheet" href="/AS-CloudDocs/assets/style-8d9bb470.css">
    <link rel="modulepreload" href="/AS-CloudDocs/assets/app-8a5b6cee.js"><link rel="modulepreload" href="/AS-CloudDocs/assets/framework-bf3e1922.js"><link rel="modulepreload" href="/AS-CloudDocs/assets/tf-upgrading.html-4c9b2a1d.js"><link rel="modulepreload" href="/AS-CloudDocs/assets/tf-upgrading.html-6ce3d839.js"><link rel="prefetch" href="/AS-CloudDocs/assets/design-for-cloud.html-e3e6985a.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/docs-site.html-a6bca91d.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/index.html-ac42d4d0.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/roles-responsibilities.html-3feb0b71.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/tools.html-38f39951.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/gha.html-8763b46f.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/jenkins-ecs-agent.html-32bf77fb.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/jenkins.html-eeb73f8b.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/shared-libs.html-ca68e6f9.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/app-patterns.html-82606c60.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/express-stack.html-864c349f.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/frontend-stacks.html-eba6411d.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/laravel-stack.html-160edb95.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/libraries.html-f87461f9.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/principles.html-2c5352b1.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/spring-stack.html-dee49009.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/appendix-lockfile-resolution.html-f3d842c0.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/index.html-913c9661.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/policies.html-d58c6ac1.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/workflow.html-4b12229b.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/as-tf-modules.html-c0436e08.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/available-modules.html-64d9f0b8.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/example-tf.html-3e2bec55.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/faq.html-8002e0df.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/state-buckets.html-4597ad6a.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/terraform-concepts.html-0d3ff65e.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/tf-import.html-69892b13.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/tf-move.html-808560e0.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/alb.html-25c300d7.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/alerts.html-13b3b670.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/api-gateway.html-4e0f7499.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/aws-account-design.html-6702f588.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/aws-service-scheduler.html-e7e3b802.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/certificates.html-66a01ff2.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/cloudfront.html-219aab7f.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/databases.html-f49e5a2e.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/ecs-fargate.html-eb295c37.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/file-handling-on-lambda.html-4d8e3ad7.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/iam.html-4d114a5a.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/lambda.html-231ba984.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/secrets.html-6e3449b6.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/ses.html-d71c62dd.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/tagging.html-28fc8474.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/vapor.html-046e9623.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/vpc-ip-addr.html-8035beaf.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/sso-approaches.html-102f0f19.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/design-for-cloud.html-4dd31c74.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/docs-site.html-fbf52cbf.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/index.html-ab2fbc54.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/roles-responsibilities.html-46dca0b3.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/tools.html-728acd6e.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/gha.html-a484cf99.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/jenkins-ecs-agent.html-6308916b.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/jenkins.html-c47ab041.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/shared-libs.html-4a4e6744.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/app-patterns.html-bbcefef3.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/express-stack.html-3d8a3e7b.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/frontend-stacks.html-243726ac.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/laravel-stack.html-d04031d3.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/libraries.html-0b7de83b.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/principles.html-44766084.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/spring-stack.html-20617a24.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/appendix-lockfile-resolution.html-034a2571.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/index.html-ca3820e5.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/policies.html-72b74ba5.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/workflow.html-9d929af1.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/as-tf-modules.html-5159005a.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/available-modules.html-e4b9dfbc.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/example-tf.html-818a6c36.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/faq.html-907bdb12.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/state-buckets.html-7d84188d.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/terraform-concepts.html-65a1b54f.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/tf-import.html-fdaa2fce.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/tf-move.html-4ac4614b.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/alb.html-0e23eeea.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/alerts.html-9b7d2b16.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/api-gateway.html-17cf8d2f.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/aws-account-design.html-e06118b5.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/aws-service-scheduler.html-88a9a051.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/certificates.html-dd896368.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/cloudfront.html-2758f297.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/databases.html-ac58d857.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/ecs-fargate.html-1e2d2402.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/file-handling-on-lambda.html-8b0d776b.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/iam.html-4df58de8.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/lambda.html-ff44078e.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/secrets.html-dfe3350a.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/ses.html-0f37c25f.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/tagging.html-5abfc1c2.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/vapor.html-2f9cd3d6.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/vpc-ip-addr.html-39e518c9.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/sso-approaches.html-3a252f20.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/404.html-339ea0b5.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/SearchResult-839e2bcb.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/mermaid.esm.min-bc08675d.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/mermaid-mindmap.esm.min-e2782ebf.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/AS-CloudDocs/" class=""><!----><span class="site-name">AS Cloud Docs</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/NIT-Administrative-Systems/AS-CloudDocs" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><button class="search-pro-button" role="search" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg></button><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/NIT-Administrative-Systems/AS-CloudDocs" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Introduction <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/AS-CloudDocs/" class="sidebar-item" aria-label="Overview"><!--[--><!--]--> Overview <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/roles-responsibilities.html" class="sidebar-item" aria-label="Roles &amp; Responsibilities"><!--[--><!--]--> Roles &amp; Responsibilities <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/design-for-cloud.html" class="sidebar-item" aria-label="Designing Apps for the Cloud"><!--[--><!--]--> Designing Apps for the Cloud <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/tools.html" class="sidebar-item" aria-label="Tool Recommendations"><!--[--><!--]--> Tool Recommendations <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/docs-site.html" class="sidebar-item" aria-label="Documentation Site"><!--[--><!--]--> Documentation Site <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Infrastructure <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/AS-CloudDocs/infrastructure/aws-account-design.html" class="sidebar-item" aria-label="AWS Account Structure"><!--[--><!--]--> AWS Account Structure <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/infrastructure/tagging.html" class="sidebar-item" aria-label="Tagging Resources"><!--[--><!--]--> Tagging Resources <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/infrastructure/vpc-ip-addr.html" class="sidebar-item" aria-label="VPCs &amp; IP Addressing"><!--[--><!--]--> VPCs &amp; IP Addressing <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/infrastructure/alb.html" class="sidebar-item" aria-label="Application Load Balancers"><!--[--><!--]--> Application Load Balancers <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/infrastructure/certificates.html" class="sidebar-item" aria-label="Certificates"><!--[--><!--]--> Certificates <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/infrastructure/api-gateway.html" class="sidebar-item" aria-label="API Gateway"><!--[--><!--]--> API Gateway <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/infrastructure/lambda.html" class="sidebar-item" aria-label="Lambda"><!--[--><!--]--> Lambda <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/infrastructure/file-handling-on-lambda.html" class="sidebar-item" aria-label="File Handling on Lambda"><!--[--><!--]--> File Handling on Lambda <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/infrastructure/ecs-fargate.html" class="sidebar-item" aria-label="Fargate for ECS"><!--[--><!--]--> Fargate for ECS <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/infrastructure/ses.html" class="sidebar-item" aria-label="Simple Email Service (SES)"><!--[--><!--]--> Simple Email Service (SES) <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/infrastructure/iam.html" class="sidebar-item" aria-label="Identity &amp; Access Management (IAM)"><!--[--><!--]--> Identity &amp; Access Management (IAM) <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/infrastructure/databases.html" class="sidebar-item" aria-label="Databases"><!--[--><!--]--> Databases <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/infrastructure/secrets.html" class="sidebar-item" aria-label="Secret Management"><!--[--><!--]--> Secret Management <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/infrastructure/alerts.html" class="sidebar-item" aria-label="Alerts"><!--[--><!--]--> Alerts <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/infrastructure/cloudfront.html" class="sidebar-item" aria-label="CloudFront CDN"><!--[--><!--]--> CloudFront CDN <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/infrastructure/vapor.html" class="sidebar-item" aria-label="Laravel Vapor"><!--[--><!--]--> Laravel Vapor <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/infrastructure/aws-service-scheduler.html" class="sidebar-item" aria-label="AWS Service Scheduler"><!--[--><!--]--> AWS Service Scheduler <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">Infrastructure as Code <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/AS-CloudDocs/iac/terraform-concepts.html" class="sidebar-item" aria-label="Terraform"><!--[--><!--]--> Terraform <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/iac/as-tf-modules.html" class="sidebar-item" aria-label="AS Terraform Modules"><!--[--><!--]--> AS Terraform Modules <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/iac/example-tf.html" class="sidebar-item" aria-label="Example Terraform Module"><!--[--><!--]--> Example Terraform Module <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/iac/available-modules.html" class="sidebar-item" aria-label="Available Modules"><!--[--><!--]--> Available Modules <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/iac/state-buckets.html" class="sidebar-item" aria-label="State Bucket Reference"><!--[--><!--]--> State Bucket Reference <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/iac/tf-import.html" class="sidebar-item" aria-label="Terraform Import"><!--[--><!--]--> Terraform Import <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/iac/tf-move.html" class="sidebar-item" aria-label="Terraform State Move"><!--[--><!--]--> Terraform State Move <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/AS-CloudDocs/iac/tf-upgrading.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Upgrading Terraform"><!--[--><!--]--> Upgrading Terraform <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/AS-CloudDocs/iac/tf-upgrading.html#strategy" class="router-link-active router-link-exact-active sidebar-item" aria-label="Strategy"><!--[--><!--]--> Strategy <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/AS-CloudDocs/iac/tf-upgrading.html#upgrading-from-v0-10" class="router-link-active router-link-exact-active sidebar-item" aria-label="Upgrading from v0.10"><!--[--><!--]--> Upgrading from v0.10 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/AS-CloudDocs/iac/tf-upgrading.html#going-live-with-the-upgrade" class="router-link-active router-link-exact-active sidebar-item" aria-label="Going Live with the Upgrade"><!--[--><!--]--> Going Live with the Upgrade <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/AS-CloudDocs/iac/tf-upgrading.html#vs-code-support" class="router-link-active router-link-exact-active sidebar-item" aria-label="VS Code Support"><!--[--><!--]--> VS Code Support <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/AS-CloudDocs/iac/faq.html" class="sidebar-item" aria-label="Frequently Asked Questions"><!--[--><!--]--> Frequently Asked Questions <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">CI &amp; CD <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/AS-CloudDocs/ci-cd/jenkins.html" class="sidebar-item" aria-label="Jenkins Pipelines"><!--[--><!--]--> Jenkins Pipelines <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/ci-cd/shared-libs.html" class="sidebar-item" aria-label="Shared Library"><!--[--><!--]--> Shared Library <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/ci-cd/jenkins-ecs-agent.html" class="sidebar-item" aria-label="Jenkins ECS Agent"><!--[--><!--]--> Jenkins ECS Agent <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/ci-cd/gha.html" class="sidebar-item" aria-label="GitHub Actions"><!--[--><!--]--> GitHub Actions <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Application Development <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/AS-CloudDocs/development/principles.html" class="sidebar-item" aria-label="Design Principles"><!--[--><!--]--> Design Principles <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/development/app-patterns.html" class="sidebar-item" aria-label="Application Patterns"><!--[--><!--]--> Application Patterns <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/development/laravel-stack.html" class="sidebar-item" aria-label="Laravel Stack"><!--[--><!--]--> Laravel Stack <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/development/express-stack.html" class="sidebar-item" aria-label="ExpressJS Stack"><!--[--><!--]--> ExpressJS Stack <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/development/spring-stack.html" class="sidebar-item" aria-label="Spring Stack"><!--[--><!--]--> Spring Stack <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/development/frontend-stacks.html" class="sidebar-item" aria-label="Frontend Stacks"><!--[--><!--]--> Frontend Stacks <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/development/libraries.html" class="sidebar-item" aria-label="Packages &amp; Libraries"><!--[--><!--]--> Packages &amp; Libraries <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Security <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/AS-CloudDocs/security/sso-approaches.html" class="sidebar-item" aria-label="Single Sign-on"><!--[--><!--]--> Single Sign-on <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Git &amp; GitHub <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/AS-CloudDocs/github/" class="sidebar-item" aria-label="Overview"><!--[--><!--]--> Overview <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/github/policies.html" class="sidebar-item" aria-label="Policies"><!--[--><!--]--> Policies <!--[--><!--]--></a><!----></li><li><a href="/AS-CloudDocs/github/workflow.html" class="sidebar-item" aria-label="Workflows"><!--[--><!--]--> Workflows <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="upgrading-terraform" tabindex="-1"><a class="header-anchor" href="#upgrading-terraform" aria-hidden="true">#</a> Upgrading Terraform</h1><p>Prior to January 2020, all IaC was written in Terraform v0.10.x. One selected version of the <code>terraform</code> command was available on the Jenkins servers.</p><p>The v0.10 series has reached the end of its useful life: the AWS provider will <a href="https://www.hashicorp.com/blog/deprecating-terraform-0-11-support-in-terraform-providers/" target="_blank" rel="noopener noreferrer">no longer be updated<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for Terraform 0.11 and older. Without active support on the AWS provider, new AWS features will be unavailable to us. As time goes on, AWS API changes may leave existing IaC modules broken &amp; unable to build.</p><h2 id="strategy" tabindex="-1"><a class="header-anchor" href="#strategy" aria-hidden="true">#</a> Strategy</h2><p>A utility called <a href="https://github.com/tfutils/tfenv" target="_blank" rel="noopener noreferrer"><code>tfenv</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> is available on the Jenkins servers. This is similar to Python&#39;s <code>virtual_env</code>, Node&#39;s <code>nvm</code>, or Ruby&#39;s <code>rbenv</code>. It allows you to select a specific version of Terraform on a per-project basis.</p><p>This utility will allow us to run multiple versions of Terraform on the same Jenkins server. Projects may be upgraded one-by-one, instead of needing all jobs on one Jenkins server to upgrade to Terraform v0.12 in unison.</p><h2 id="upgrading-from-v0-10" tabindex="-1"><a class="header-anchor" href="#upgrading-from-v0-10" aria-hidden="true">#</a> Upgrading from v0.10</h2><p>The Terraform language has undergone significant changes in v0.12. It has a tool to convert your terraform files, but there are some items that cannot be automatically updated.</p><p>You should carefully review <a href="https://www.terraform.io/upgrade-guides/0-12.html" target="_blank" rel="noopener noreferrer">the official upgrade guide<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and identify any features you are using that may require your attention before you undertake an upgrade.</p><ol><li><p>Install the <code>tfenv</code> command on your workstation</p><p>You should remove any versions of Terraform that you had installed previously; they can be re-installed under <code>tfenv</code>&#39;s management</p></li><li><p>Create a new git branch for the upgrade</p></li><li><p>Create a <code>.terraform-version</code> file in the root of your project. This file is used by <code>tfenv</code> to determine what version to install</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">cat</span> .terraform-version
latest:0.12
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Install terraform by running <code>tfenv install</code> in the root of your project</p></li><li><p>Run the automatic upgrade command for each folder containing <code>.tf</code> files.</p><p>The <a href="/AS-CloudDocs/iac/as-tf-modules.html" class="">recommended module structure</a> dictates that all env-specific modules use the same &#39;base&#39; code. This means all the env-specific modules must be upgraded alongside it. You cannot piecemeal this step.</p><p>The upgrade tool considers these on a folder-by-folder basis. It will not follow references to other folders or remote modules.</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># This is an example -- your base module &amp; envs may differ.</span>
<span class="token comment"># If you have any .tf files in the project root, make sure to do</span>
<span class="token comment"># that folder as well.</span>
$ terraform <span class="token number">0</span>.12upgrade <span class="token parameter variable">-yes</span> sandbox/
$ terraform <span class="token number">0</span>.12upgrade <span class="token parameter variable">-yes</span> nonprod/
$ terraform <span class="token number">0</span>.12upgrade <span class="token parameter variable">-yes</span> prod/

<span class="token comment"># Any modules that use providers will need those providers installed</span>
<span class="token comment"># before they can be upgraded.</span>
$ terraform init base/
$ terraform <span class="token number">0</span>.12upgrade <span class="token parameter variable">-yes</span> base/
$ <span class="token function">rm</span> <span class="token parameter variable">-rf</span> base/.terraform
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Adjust your <code>.terraform-version</code> file again. The upgrade may have written a specific patch version, but we want on-the-fly updates for the patch version.</p><p>It should be:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">cat</span> .terraform-version
latest:0.12
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Remove any <code>versions.tf</code> files in your environment-specific folders.</p><p>This file tells Terraform the minimum version number the module may run on. The upgrade command will emit these for each folder it is run in.</p><p>In the interest of DRY code, we only want this file in the base module that all of the env-specific modules use. They will all inherently rely on its version specification.</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># From the project root:</span>
$ <span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-name</span> versions.tf
./prod/versions.tf
./nonprod/versions.tf
./sandbox/versions.tf
./base/versions.tf

<span class="token comment"># Leave the one in base, but remove all others:</span>
$ <span class="token function">rm</span> ./prod/versions.tf ./nonprod/versions.tf ./sandbox/versions.tf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>If you have pinned the AWS provider version for your module, review this and decide if it is appropriate to update the version.</p><p>This was done for some IaC modules. The older provider uses older AWS APIs, allowing the module to build without making changes that Amazon needs for the newer APIs.</p><p>This is a good opportunity to review and upgrade to the latest provider.</p><p>If you have pinned the provider version, it will look like this:</p><div class="language-hcl line-numbers-mode" data-ext="hcl"><pre class="language-hcl"><code><span class="token keyword">provider<span class="token type variable"> &quot;aws&quot; </span></span><span class="token punctuation">{</span>
    <span class="token comment"># Pinned to 1.33 and older</span>
    <span class="token property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;&lt;= 1.13.0&quot;</span>

    <span class="token comment"># Pinned to 1.60.x</span>
    <span class="token property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;~&gt; 1.60&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You should at least migrate to the 2.x provider. The latest version can be found on the <a href="https://registry.terraform.io/providers/hashicorp/aws" target="_blank" rel="noopener noreferrer">Terraform registry<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. If you move to the latest evrsion, you can set up Dependabot for the repository and receive pull requests when new versions of the provider are available.</p></li><li><p>If you are using any of the <a href="/AS-CloudDocs/iac/available-modules.html" class="">AS shared modules</a>, you will need to use their <code>tf-0.12</code> branch. All you need to do is add/update <code>?ref=&lt;branch name&gt;</code> in the git URLs.</p><div class="language-hcl line-numbers-mode" data-ext="hcl"><pre class="language-hcl"><code><span class="token keyword">module<span class="token type variable"> &quot;alb&quot; </span></span><span class="token punctuation">{</span>
    <span class="token property">source</span> <span class="token punctuation">=</span> <span class="token string">&quot;github.com/NIT-Administrative-Systems/AS-Common-AWS-Modules//alb?ref=tf-0.12&quot;</span>

    <span class="token comment">// . . .</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Run the validator tool for each module and review your Terraform code.</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> nonprod
$ terraform init <span class="token comment"># errors about the state file are expected and OK</span>
$ terraform validate
$ <span class="token function">rm</span> <span class="token parameter variable">-rf</span> .terraform
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Fix any errors raised by the upgrade tool &amp; any other issues you identify.</p><p>Warnings will be called out when you run the upgrade command, but they will be annotated in the code as well. Look for <code>TF-UPGRADE-TODO</code> comments.</p></li><li><p>Log in to AWS from your console and review the plan</p><p>You can use the <a href="/AS-CloudDocs/iac/terraform-concepts.html#developing-testing-iac" class="">aws-adfs tool</a> to log in to AWS on your console. Select the correct account (e.g. planning dev = nonprod AWS account) when logging in.</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> nonprod/
$ terraform init
$ terraform plan
$ <span class="token function">rm</span> <span class="token parameter variable">-rf</span> .terraform
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In most cases, the plan will show no changes. There may be exceptions to this. You can review older deployments to determine if that was normal in v0.10; if it was, the v0.10 and v0.12 plans should reflect that the same resources need to change. The exceptions we know about are:</p><ul><li>API Gateway deployments may show up if a run will always re-deploy the API Gateway</li><li>Lambdas may show up if the code or dependencies have changed, since the last modified date, source code hash, and/or etag (for the zip containing the code) have changed</li></ul><p>You may not be able to generate a complete plan. If you are using encrypted SSM parameters with a custom KMS key, you will not have enough access to decrypt the values, which Terraform wants to consider for its plan.</p></li><li><p>Update your Jenkins pipeline files to use <code>tfenv</code> and auto-approve the plan</p><p>You will need a new stage before <code>terraform</code> is used to grab the correct version for your project. In the context of your <code>stages</code> block, prepend:</p><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>stage <span class="token punctuation">(</span><span class="token string">&#39;tfenv&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    steps <span class="token punctuation">{</span>
        sh <span class="token string">&#39;tfenv install&#39;</span>
        sh <span class="token string">&#39;terraform -version&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You will also need to add the <code>-auto-approve</code> flag to <code>terraform apply</code>:</p><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code>stage <span class="token punctuation">(</span><span class="token string">&#39;Existing Apply Stage&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    steps <span class="token punctuation">{</span>
        sh <span class="token string">&#39;terraform apply -auto-approve -no-color&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h2 id="going-live-with-the-upgrade" tabindex="-1"><a class="header-anchor" href="#going-live-with-the-upgrade" aria-hidden="true">#</a> Going Live with the Upgrade</h2><p>Once your v0.12 changes are valid, moving the new module into production should be painless. The underlying terraform code may have been updated, but the <code>terraform plan</code> should be unchanged. No changes should be made to your infrastructure as a result of this upgrade.</p><p>After you run <code>terraform apply</code> with the new version of terraform, that module&#39;s <code>tfstate</code> is updated. This occurs even if the <code>terraform apply</code> command fails to fully execute. You cannot revert to a older version of terraform. This is applicable even for minor version bumps (e.g. 0.12.19 to 0.12.20).</p><h2 id="vs-code-support" tabindex="-1"><a class="header-anchor" href="#vs-code-support" aria-hidden="true">#</a> VS Code Support</h2><p>If you are using the Terraform VS Code extension, you will need to make adjustments to its configuration so it will work with the v0.12 language changes.</p><p>In your VS Code setting JSON file, set these options:</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token comment">// . . .</span>
    <span class="token property">&quot;terraform.indexing.enabled&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;terraform.languageServer.enabled&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Restart VS Code. It should prompt you to install &amp; run the Terraform Language Server. Once complete, you should regain the full use of the extension.</p></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/NIT-Administrative-Systems/AS-CloudDocs/edit/stable/iac/tf-upgrading.md" rel="noopener noreferrer" target="_blank" aria-label="Edit Page"><!--[--><!--]--> Edit Page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: jason.miller@northwestern.edu">Jason Miller</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/AS-CloudDocs/iac/tf-move.html" class="" aria-label="Terraform State Move"><!--[--><!--]--> Terraform State Move <!--[--><!--]--></a></span><span class="next"><a href="/AS-CloudDocs/iac/faq.html" class="" aria-label="Frequently Asked Questions"><!--[--><!--]--> Frequently Asked Questions <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!----><!--]--></div>
    <script type="module" src="/AS-CloudDocs/assets/app-8a5b6cee.js" defer></script>
  </body>
</html>
