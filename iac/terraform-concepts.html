<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Terraform | AS Cloud Docs</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link href="https://common.northwestern.edu/v8/icons/favicon-16.png" rel="icon" sizes="16x16" type="image/png">
    <link href="https://common.northwestern.edu/v8/icons/favicon-32.png" rel="icon" sizes="32x32" type="image/png">
    <meta name="description" content="Docs for Northwestern IT staff on our cloud implementation.">
    
    <link rel="preload" href="/AS-CloudDocs/assets/css/0.styles.425dfd68.css" as="style"><link rel="preload" href="/AS-CloudDocs/assets/js/app.2d45c4fc.js" as="script"><link rel="preload" href="/AS-CloudDocs/assets/js/2.1981cd55.js" as="script"><link rel="preload" href="/AS-CloudDocs/assets/js/32.b43eac73.js" as="script"><link rel="prefetch" href="/AS-CloudDocs/assets/js/10.817e36c9.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/11.3f6da0b0.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/12.47e84d50.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/13.9214e9be.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/14.ba329726.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/15.b322c67e.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/16.63d867c1.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/17.698887a5.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/18.08a1d6c6.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/19.9e2348f7.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/20.1bab3fb9.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/21.f66ab42a.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/22.7908c566.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/23.c0cdf4ed.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/24.6cde5c32.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/25.2e3b8486.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/26.a0da6c32.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/27.5d75500c.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/28.c1a33562.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/29.e1e6744f.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/3.fea76ffe.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/30.2652e855.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/31.e737a602.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/33.69463bcb.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/34.7bbea69d.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/35.255fd512.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/36.47616b19.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/37.0271a862.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/38.58da5b62.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/39.6ae82d62.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/4.fd8a9d0a.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/40.1b21cab9.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/41.1b2647e2.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/42.0cf37b60.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/43.3cfc71df.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/44.08927194.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/45.f313f02b.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/46.06513cd5.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/47.adaa6241.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/48.a0e2ec9e.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/49.91d80233.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/5.f8165a6e.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/50.f6a459b5.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/51.723e0004.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/6.1f42bd9f.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/7.47c3d4b9.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/8.8d33b76a.js"><link rel="prefetch" href="/AS-CloudDocs/assets/js/9.24df5b62.js">
    <link rel="stylesheet" href="/AS-CloudDocs/assets/css/0.styles.425dfd68.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/AS-CloudDocs/" class="home-link router-link-active"><!----> <span class="site-name">AS Cloud Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/NIT-Administrative-Systems/AS-CloudDocs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/NIT-Administrative-Systems/AS-CloudDocs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Introduction</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/" aria-current="page" class="sidebar-link">Overview</a></li><li><a href="/AS-CloudDocs/roles-responsibilities.html" class="sidebar-link">Roles &amp; Responsibilities</a></li><li><a href="/AS-CloudDocs/design-for-cloud.html" class="sidebar-link">Designing Apps for the Cloud</a></li><li><a href="/AS-CloudDocs/tools.html" class="sidebar-link">Tool Recommendations</a></li><li><a href="/AS-CloudDocs/docs-site.html" class="sidebar-link">Documentation Site</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Infrastructure</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/infrastructure/aws-account-design.html" class="sidebar-link">AWS Account Structure</a></li><li><a href="/AS-CloudDocs/infrastructure/tagging.html" class="sidebar-link">Tagging Resources</a></li><li><a href="/AS-CloudDocs/infrastructure/vpc-ip-addr.html" class="sidebar-link">VPCs &amp; IP Addressing</a></li><li><a href="/AS-CloudDocs/infrastructure/alb.html" class="sidebar-link">Application Load Balancers</a></li><li><a href="/AS-CloudDocs/infrastructure/certificates.html" class="sidebar-link">Certificates</a></li><li><a href="/AS-CloudDocs/infrastructure/api-gateway.html" class="sidebar-link">API Gateway</a></li><li><a href="/AS-CloudDocs/infrastructure/lambda.html" class="sidebar-link">Lambda</a></li><li><a href="/AS-CloudDocs/infrastructure/ecs-fargate.html" class="sidebar-link">Fargate for ECS</a></li><li><a href="/AS-CloudDocs/infrastructure/ses.html" class="sidebar-link">Simple Email Service (SES)</a></li><li><a href="/AS-CloudDocs/infrastructure/iam.html" class="sidebar-link">Identity &amp; Access Management (IAM)</a></li><li><a href="/AS-CloudDocs/infrastructure/databases.html" class="sidebar-link">Databases</a></li><li><a href="/AS-CloudDocs/infrastructure/secrets.html" class="sidebar-link">Secret Management</a></li><li><a href="/AS-CloudDocs/infrastructure/alerts.html" class="sidebar-link">Alerts</a></li><li><a href="/AS-CloudDocs/infrastructure/cloudfront.html" class="sidebar-link">CloudFront CDN</a></li><li><a href="/AS-CloudDocs/infrastructure/vapor.html" class="sidebar-link">Laravel Vapor</a></li><li><a href="/AS-CloudDocs/infrastructure/aws-service-scheduler.html" class="sidebar-link">AWS Service Scheduler</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Infrastructure as Code</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/iac/terraform-concepts.html" aria-current="page" class="active sidebar-link">Terraform</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/AS-CloudDocs/iac/terraform-concepts.html#concepts" class="sidebar-link">Concepts</a></li><li class="sidebar-sub-header"><a href="/AS-CloudDocs/iac/terraform-concepts.html#developing-testing-iac" class="sidebar-link">Developing &amp; Testing IaC</a></li><li class="sidebar-sub-header"><a href="/AS-CloudDocs/iac/terraform-concepts.html#more-about-configuring-profiles-in-the-aws-adfs-utility" class="sidebar-link">More About Configuring Profiles in the AWS-ADFS Utility</a></li><li class="sidebar-sub-header"><a href="/AS-CloudDocs/iac/terraform-concepts.html#shortcut-configuration" class="sidebar-link">Shortcut Configuration</a></li></ul></li><li><a href="/AS-CloudDocs/iac/as-tf-modules.html" class="sidebar-link">AS Terraform Modules</a></li><li><a href="/AS-CloudDocs/iac/example-tf.html" class="sidebar-link">Example Terraform Module</a></li><li><a href="/AS-CloudDocs/iac/available-modules.html" class="sidebar-link">Available Modules</a></li><li><a href="/AS-CloudDocs/iac/state-buckets.html" class="sidebar-link">State Bucket Reference</a></li><li><a href="/AS-CloudDocs/iac/tf-import.html" class="sidebar-link">Terraform Import</a></li><li><a href="/AS-CloudDocs/iac/tf-move.html" class="sidebar-link">Terraform State Move</a></li><li><a href="/AS-CloudDocs/iac/tf-upgrading.html" class="sidebar-link">Upgrading Terraform</a></li><li><a href="/AS-CloudDocs/iac/faq.html" class="sidebar-link">Frequently Asked Questions</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CI &amp; CD</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/ci-cd/jenkins.html" class="sidebar-link">Jenkins Pipelines</a></li><li><a href="/AS-CloudDocs/ci-cd/shared-libs.html" class="sidebar-link">Shared Library</a></li><li><a href="/AS-CloudDocs/ci-cd/jenkins-ecs-agent.html" class="sidebar-link">Jenkins ECS Agent</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Application Development</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/development/principles.html" class="sidebar-link">Design Principles</a></li><li><a href="/AS-CloudDocs/development/app-patterns.html" class="sidebar-link">Application Patterns</a></li><li><a href="/AS-CloudDocs/development/laravel-stack.html" class="sidebar-link">Laravel Stack</a></li><li><a href="/AS-CloudDocs/development/express-stack.html" class="sidebar-link">ExpressJS Stack</a></li><li><a href="/AS-CloudDocs/development/spring-stack.html" class="sidebar-link">Spring Stack</a></li><li><a href="/AS-CloudDocs/development/frontend-stacks.html" class="sidebar-link">Frontend Stacks</a></li><li><a href="/AS-CloudDocs/development/libraries.html" class="sidebar-link">Packages &amp; Libraries</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Security</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/security/sso-approaches.html" class="sidebar-link">Single Sign-on</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>GitHub</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/AS-CloudDocs/github/settings-permissions.html" class="sidebar-link">Settings &amp; Permissions</a></li><li><a href="/AS-CloudDocs/github/repo-layout.html" class="sidebar-link">Repository Structure</a></li><li><a href="/AS-CloudDocs/github/workflow.html" class="sidebar-link">Workflow</a></li><li><a href="/AS-CloudDocs/github/policies.html" class="sidebar-link">Policy</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="terraform"><a href="#terraform" class="header-anchor">#</a> Terraform</h1> <p>Infrastructure as Code (IaC) is a way to define what resources &amp; configuration you need to run an application. These declarations can then be stored in git. This approach eliminates the potential for human error when setting up multiple servers &amp; configuration drift between environments.</p> <p>All cloud resources in the prod &amp; nonprod environments must be created as IaC, and account permissions will reflect this policy.</p> <p><a href="https://www.terraform.io/" target="_blank" rel="noopener noreferrer">Terraform<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is the vendor-agnostic IaC tool that Administrative Systems uses. When you write your IaC, terraform will determine which service providers you need and will automatically download the appropriate <a href="https://www.terraform.io/docs/providers/index.html" target="_blank" rel="noopener noreferrer">provider drivers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>For the most part, AS developers will only need to be concerned with the <a href="https://www.terraform.io/docs/providers/aws/index.html" target="_blank" rel="noopener noreferrer">AWS provider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. But if the need arises, you can use terraform to build infrastructure for one app across several cloud vendors.</p> <div class="custom-block warning"><p class="custom-block-title">Terraform Version</p> <p>Prior to January 2020, we used Terraform v0.10. We are in the process of migrating to TF 0.12.</p> <p>All new IaC development should be done using TF 0.12. We recommend installing <a href="https://github.com/tfutils/tfenv" target="_blank" rel="noopener noreferrer"><code>tfenv</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to manage your TF versions.</p> <p>You should upgrade your older modules to v0.12 -- see the AS <a href="/AS-CloudDocs/iac/tf-upgrading.html">upgrade guide</a> for guidance.</p></div> <h2 id="concepts"><a href="#concepts" class="header-anchor">#</a> Concepts</h2> <p>A simple terraform module is made up of three parts: provider blocks, a backend, and the infrastructure resources you want.</p> <div class="language-hcl extra-class"><pre class="language-hcl"><code><span class="token comment"># Provider Block</span>
<span class="token comment"># --------------</span>

<span class="token comment"># Declares that we need the AWS provider and sets a default region.</span>
<span class="token comment"># The version argument tells TF that it should use any stable v2.27.x provider.</span>
<span class="token keyword">provider<span class="token type variable"> &quot;aws&quot; </span></span><span class="token punctuation">{</span>
  <span class="token property">region</span> <span class="token punctuation">=</span> <span class="token string">&quot;us-east-2&quot;</span>
  <span class="token property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;~&gt; 2.27&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># Backend Block</span>
<span class="token comment"># -------------</span>

<span class="token comment"># This block tells Terraform that it should remember what</span>
<span class="token comment"># resources it has created using a file in an S3 bucket.</span>
<span class="token keyword">terraform</span> <span class="token punctuation">{</span>
  <span class="token keyword">backend<span class="token type variable"> &quot;s3&quot; </span></span><span class="token punctuation">{</span>
    <span class="token property">bucket</span> <span class="token punctuation">=</span> <span class="token string">&quot;accountName-nonprod-build-tfstate&quot;</span>
    <span class="token property">key</span>    <span class="token punctuation">=</span> <span class="token string">&quot;accountName-shared-resources/nonprod/terraform.tfstate&quot;</span>
    <span class="token property">region</span> <span class="token punctuation">=</span> <span class="token string">&quot;us-east-2&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># Resource Blocks</span>
<span class="token comment"># ---------------</span>

<span class="token comment"># Creates a Simple Notification Service topic</span>
<span class="token keyword">resource <span class="token type variable">&quot;aws_sns_topic&quot;</span></span> <span class="token string">&quot;opsgenie_alert_topic&quot;</span> <span class="token punctuation">{</span>
  <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;OpsGenie-SomeTeam&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># Adds OpsGenie's alert API as a subscriber to that topic,</span>
<span class="token comment"># using the Amazon Resource Name (ARN) that the previous resource</span>
<span class="token comment"># output.</span>
<span class="token keyword">resource <span class="token type variable">&quot;aws_sns_topic_subscription&quot;</span></span> <span class="token string">&quot;opsgenie_integration&quot;</span> <span class="token punctuation">{</span>
  <span class="token property">topic_arn</span>              <span class="token punctuation">=</span> aws_sns_topic.opsgenie_alert_topic.arn<span class="token string">&quot;
  protocol               = &quot;</span>https<span class="token string">&quot;
  endpoint               = &quot;</span>https:<span class="token comment">//api.opsgenie.com/alert/SomeTeam?apiKey=MyVeryCoolSecret&quot;</span>
  <span class="token property">endpoint_auto_confirms</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Terraform will automatically determine that it needs to create the topic before it can create the subscription, since the subscription is using an <em>attribute</em> (the ARN) from the topic resource.</p> <p>Every resource is different. The terraform AWS provider documentation will explain what arguments (inputs) &amp; attributes (outputs) are available. For example, the <a href="https://www.terraform.io/docs/providers/aws/r/sns_topic.html" target="_blank" rel="noopener noreferrer"><code>aws_sns_topic</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> documentation tells us that we could set a <code>display_name</code> argument too.</p> <h2 id="developing-testing-iac"><a href="#developing-testing-iac" class="header-anchor">#</a> Developing &amp; Testing IaC</h2> <p>Before you begin, you should install the <a href="https://marketplace.visualstudio.com/items?itemName=mauve.terraform" target="_blank" rel="noopener noreferrer">terraform extension for VS Code<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. This will give you a code formatter, syntax highlighting, tab completion, and quick navigation.</p> <p>You may check your TF code compiles with the <code>terraform validate</code> command. You will need to <code>terraform init</code> your module beforehand. If the <code>init</code> gives you errors about the S3 bucket, that is OK: the state bucket is only needed when you are planning/deploying/destroying.</p> <p>Infrastructure in the nonprod &amp; prod accounts may only be created by terraform running on your Jenkins server -- your own AWS login will not be able to create anything. If you wish to test terraform from your own machine, you can log in to the sandbox with the <a href="https://github.com/venth/aws-adfs" target="_blank" rel="noopener noreferrer">aws-adfs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> utility.</p> <div class="custom-block tip"><p class="custom-block-title">`aws-adfs` &amp; Duo</p> <p>Before using the <code>aws-adfs</code> utility, you will need to configure Duo to automatically send you push notifications.</p> <p>When logging in to <a href="https://aws.northwestern.edu" target="_blank" rel="noopener noreferrer">aws.northwestern.edu<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, hit the <em>Settings</em> tab on your Duo popup, then <em>My Settings &amp; Devices</em>.</p> <p>Choose <em>Automatically Send this Device a Duo Push</em> to enable this functionality.</p></div> <p>Once installed, you can run the utility with the below arguments. Your username should be in the format <code>ads\netid</code>.</p> <div class="language-sh extra-class"><pre class="language-sh"><code>aws-adfs login --adfs-host<span class="token operator">=</span>ads-fed.northwestern.edu --provider-id urn:amazon:webservices --region us-east-2 --no-sspi
</code></pre></div><p>Once logged in, the utility will prompt you to choose the AWS account to use.</p> <h2 id="more-about-configuring-profiles-in-the-aws-adfs-utility"><a href="#more-about-configuring-profiles-in-the-aws-adfs-utility" class="header-anchor">#</a> More About Configuring Profiles in the AWS-ADFS Utility</h2> <p>The aws-adfs utility facilitates logging you into AWS and it places your temporary credential information in your .aws/credentials files where many other applications (including terraform) know where to look and how to use it. In short, it logs into an AWS account on your behalf during the upload.</p> <p>A default profile is established based on the first AWS account you use without specifically designating a profile name. Note that you can always delete your default via the reset command and establish another one. (See below.)</p> <p>In addition to a default profile, you can create a profile for each AWS account that you use.</p> <p>There are three commands that you will need in order to work with profiles:</p> <p><strong>1. aws-adfs list</strong></p> <p>Use this to list the details of all your profiles, including the default.</p> <p><strong>2. --profile {YourProfileName}</strong></p> <p>This is added to the standard utility statement both to create a profile and to use that profile after it is created.
Once you have entered the standard utility statement with a new profile name, you will see a numbered list of all AWS account to which you have access.
Enter the number of the account that you want to associate with the profile name you entered. From that point forward, that profile name is mapped to the account you selected.</p> <p><em>For Example</em></p> <div class="language-sh extra-class"><pre class="language-sh"><code>aws-adfs login --adfs-host<span class="token operator">=</span>ads-fed.northwestern.edu --provider-id urn:amazon:webservices --region us-east-2 **--profile YourProfileName**
</code></pre></div><p><em>Using an existing profile</em></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> aws-adfs login --profile YourProfileName
</code></pre></div><p><strong>3. aws-adfs reset --profile YourProfileName</strong></p> <p>Use this to delete the named profile from the list.</p> <h2 id="shortcut-configuration"><a href="#shortcut-configuration" class="header-anchor">#</a> Shortcut Configuration</h2> <p>The utility code listed above can become tedious. To shorten the process, use follow the instructions below to install a function within your bash profile that clears the current profile and sets your newly entered profile.</p> <ol><li>Open bash editor:   vi ~/.bash_profile</li> <li>Enter i to insert</li> <li>Paste in the following code:</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token keyword">function</span> aws-adfs-<span class="token function-name function">login</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>                                                                                     
	<span class="token builtin class-name">unset</span> AWS_PROFILE
	aws-adfs login --adfs-host<span class="token operator">=</span>ads-fed.northwestern.edu --provider-id urn:amazon:webservices --profile <span class="token variable">$1</span> --no-sspi
	<span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_PROFILE</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>Enter [esc] to exit insert mode</li> <li>Enter [shift]zz to save and close</li> <li>If you are using linux, enter:   <strong>source ~/.bash_profile</strong></li> <li>To use a profile, enter the function and profile name:  <strong>aws-adfs-login [YourProfileName]</strong></li> <li>To see all your profiles, enter: <strong>aws-adfs list</strong></li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/NIT-Administrative-Systems/AS-CloudDocs/edit/stable/iac/terraform-concepts.md" target="_blank" rel="noopener noreferrer">Edit Page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/14/2022, 4:36:16 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/AS-CloudDocs/infrastructure/aws-service-scheduler.html" class="prev">
        AWS Service Scheduler
      </a></span> <span class="next"><a href="/AS-CloudDocs/iac/as-tf-modules.html">
        AS Terraform Modules
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/AS-CloudDocs/assets/js/app.2d45c4fc.js" defer></script><script src="/AS-CloudDocs/assets/js/2.1981cd55.js" defer></script><script src="/AS-CloudDocs/assets/js/32.b43eac73.js" defer></script>
  </body>
</html>
